/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
/*!
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 * @version 0.2.1
 */
function mist(t){return Mist.Component.create(Mist.Statement,t)}var Mist;!function(t){function n(t){return JSON.stringify(t.map(function(t){return t instanceof Object?t.sessions||(t.sessions=i++):t}))}var e=function(){function t(){}return t.create=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var o=n([t]),r=n(e);return this.responses[o]||(this.responses[o]={}),this.responses[o][r]||(this.responses[o][r]=new(t.bind.apply(t,[t].concat([].slice.apply(e))))),this.responses[o][r]},t.responses={},t}();t.Component=e;var i=0}(Mist||(Mist={}));/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
var Mist;!function(t){var n=function(){function t(t){var n=this.succeed,e=this.erred;this.resume(),t(n.bind(this),e.bind(this))}return t.all=function(n){return new t(function(t,e){function i(n){if(r.push(n)>o){try{t(r)}catch(i){e(i)}r=[]}}var o,r=[];n.map(function(t,n){t.then(i),o=n})})},t.race=function(n){return new t(function(t,e){n.forEach(function(n){n.then(function(n){try{t(n)}catch(i){e(i)}})})})},t.prototype["catch"]=function(n){var e=this;return new t(function(t,i){e.err=function(e){try{t(n(e))}catch(o){i(o)}},e.tx()})},t.prototype.resume=function(){this.txd=null,this.txr=null},t.prototype.then=function(n,e){var i=this;return new t(function(t,o){i.err=o,i.success=function(i){try{t(n(i))}catch(r){e?t(e(r)):o(r)}},i.tx()})},t.prototype.when=function(t,n){var e=this,i=function(n){var i=t(n);return e.resume(),i},o=n?function(t){var i=n(t);return e.resume(),i}:n;return this.then(i,o)},t.prototype.erred=function(t){var n=this;if(!this.txd){var e=this.err;e?(this.txd=!0,t instanceof Object&&t.then?t.then(e):e(t)):this.txr=function(){n.erred(t)}}},t.prototype.succeed=function(t){var n=this;if(!this.txd){var e=this.success;e?(this.txd=!0,t instanceof Object&&t.then?t.then(e):e(t)):this.txr=function(){n.succeed(t)}}},t.prototype.tx=function(){var t;(t=this.txr)&&t()},t}();t.Promise=n}(Mist||(Mist={}));/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
var Mist;!function(t){var n=function(){function n(){}return n.at=function(t,n){void 0===n&&(n=0);var e=[];e.push(n),e.push(t),this.txs.push(e),this.tx()},n.on=function(n,e){var i=this;return void 0===e&&(e=0),new t.Promise(function(t,o){var r=[];r.push(e),r.push(function(){try{t(n())}catch(e){o(e)}}),i.txs.push(r),i.tx()})},n.tx=function(){var t=this;this.txd||function(){t.txd=!0;var n;(n=function(){for(var e,i=[];e=t.txs.pop();)e[0]--<0?e[1]():i.push(e);t.txs.push.apply(t.txs,i)?requestAnimationFrame(n):t.txd=!1})()}()},n.txs=[],n}();t.Frame=n}(Mist||(Mist={}));var __extends=this&&this.__extends||function(t,n){function e(){this.constructor=t}for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)},Mist;!function(t){var n=function(n){function e(e){var i=this;this.composite=e,this.xs=[],n.call(this,function(n,e){i.xr=function(){i.xd||function(){i.xd=!0,t.Frame.at(function(){var t;try{n(i.composite)}catch(o){e(o)}for(;t=i.xs.pop();)t(i.composite);i.xd=!1})}()}})}return __extends(e,n),e.prototype.compose=function(n){var e=this;return new t.Promise(function(i){t.Frame.at(function(){e.composite=n(e.composite),e.xs.push(i),e.xr()})})},e}(t.Promise);t.Value=n}(Mist||(Mist={}));/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
var Mist;!function(t){var n=function(){function n(n){this.statement=n,this.value=new t.Value({}),this.value.when(function(t){for(var e in t)switch(t[e]){case void 0:n.each(function(t){t.removeAttribute(e)}),delete t[e];break;default:n.each(function(n){n.setAttribute(e,t[e])})}})}return n.prototype.add=function(t){return this.value.compose(function(n){for(var e in t)n[e]=t[e];return n})},n.prototype.get=function(){return this.value.composite},n.prototype.remove=function(t){return this.value.compose(function(n){return t.forEach(function(t){n[t]=void 0}),n})},n}();t.Attr=n}(Mist||(Mist={}));/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
var Mist;!function(t){var n;!function(t){t[t.A=0]="A",t[t.R=1]="R",t[t.T=2]="T"}(n||(n={}));var e=function(){function e(e){this.statement=e,this.value=new t.Value({}),this.value.when(function(t){var i=[];for(var o in t){var r=t[o];i[r]||(i[r]=[]),i[r].push(o),delete t[o]}e.each(function(t){var e,o=t.classList;!(e=i[n.A])||o.add.apply(o,e),!(e=i[n.R])||o.remove.apply(o,e),!(e=i[n.T])||e.forEach(function(t){o.toggle(t)})})})}return e.prototype.add=function(e,i){var o=this;return void 0===i&&(i=0),new t.Promise(function(r){var s=o.value.compose(function(t){return e.forEach(function(e){t[e]=n.A}),t});i>0?t.Frame.on(o.remove.bind(o,e),i).then(r):s.then(r)})},e.prototype.remove=function(e,i){var o=this;return void 0===i&&(i=0),new t.Promise(function(r){var s=o.value.compose(function(t){return e.forEach(function(e){t[e]=n.R}),t});i>0?t.Frame.on(o.add.bind(o,e),i).then(r):s.then(r)})},e.prototype.toggle=function(t){return this.value.compose(function(e){return t.forEach(function(t){switch(e[t]){case n.A:e[t]=n.R;break;case n.R:e[t]=n.A;break;case n.T:delete e[t];break;default:e[t]=n.T}}),e})},e}();t.Class=e}(Mist||(Mist={}));/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
var Mist;!function(t){var n=function(){function t(t){this.statement=t,this.emits={},this.obss={}}return t.customize=function(t,n){void 0===n&&(n={});var e=document.createEvent("CustomEvent");return e.initCustomEvent(t,n.bubbles||!0,n.cancelable||!0,n.detail),e},t.prototype.add=function(t,n){this.obss[t]||(this.obss[t]=[]),this.obss[t].push(n),this.ready(t)},t.prototype.emit=function(t,n){for(var e in this.obss[t])this.obss[t][e](n)},t.prototype.remove=function(t,n){function e(){var t=i.indexOf(n);0>t||i.splice(t,1)}var i=this.obss[t];i&&n?e():i=null},t.prototype.ready=function(t){var n=this,e=this.emits;e[t]||document.addEventListener(t,e[t]=function(e){var i=e.target;i instanceof Element&&i.closest(n.statement.selector())&&n.emit(t,e instanceof CustomEvent?e.detail:e)})},t}();t.Emitter=n}(Mist||(Mist={}));/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
var Mist;!function(t){var n=function(t){function n(n,e){t.call(this,function(t,i){n.add(e,function(n){try{t(n)}catch(e){i(e)}})}),this.emitter=n,this.name=e}return __extends(n,t),n}(t.Promise);t.Emission=n}(Mist||(Mist={}));/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
var Mist;!function(t){function n(t){return t.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})}var e=function(){function e(e){this.statement=e;var i=document.createElement("style"),o=document.createTextNode("");i.appendChild(o),document.head.appendChild(i),this.value=new t.Value([{}]),this.value.when(function(t){var o=t.map(function(t){var i=[];for(var o in t)i.push(n(o)+":"+t[o]);return e.selector()+"{"+i.join(";")+"}"});i.innerHTML=o.join("")})}return e.prototype.add=function(n,e){var i=this;return void 0===e&&(e=0),new t.Promise(function(o){var r=i.value.compose(function(r){var s=e>0?{}:r[0];for(var u in n)s[u]=n[u];if(e>0){r.push(s);var c=t.Frame.on(function(){return i.value.compose(function(t){var n=t.indexOf(s);return 0>n||t.splice(n,1),t})},e);c.then(o)}return r});e>0||r.then(o)})},e.prototype.get=function(){return this.value.composite},e.prototype.set=function(t){return this.value.compose(function(){var n={};for(var e in t)n[e]=t[e];return[n]})},e}();t.Style=e}(Mist||(Mist={}));/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
var Mist;!function(t){var n;!function(n){var e=function(){function n(n){this.emitter=n;var e=!1;!function(){var i=new t.Emission(n,"mousedown"),o=new t.Emission(n,"touchstart"),r=t.Promise.race([i,o]);r.when(function(t){n.emit("panstart",t),e=!0,i.resume(),o.resume()})}(),function(){var i=new t.Emission(n,"mousemove"),o=new t.Emission(n,"touchmove"),r=t.Promise.race([i,o]);r.when(function(t){e&&(n.emit("panmove",t),t.movementX<0&&n.emit("panleft",t),t.movementX>0&&n.emit("panright",t),t.movementY<0&&n.emit("panup",t),t.movementY>0&&n.emit("pandown",t)),i.resume(),o.resume()})}(),function(){var i=new t.Emission(n,"mouseout"),o=new t.Emission(n,"touchleave"),r=t.Promise.race([i,o]);r.when(function(t){e&&n.emit("panleave",t),e=!1,i.resume(),o.resume()})}(),function(){var i=new t.Emission(n,"mouseup"),o=new t.Emission(n,"touchcancel"),r=new t.Emission(n,"touchend"),s=t.Promise.race([i,o,r]);s.when(function(t){n.emit("panend",t),e=!1,i.resume(),o.resume(),r.resume()})}()}return n}();n.Pan=e}(n=t.Recognizer||(t.Recognizer={}))}(Mist||(Mist={}));/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
var Mist;!function(t){var n;!function(n){var e=function(){function n(n){this.emitter=n;var e=new t.Emission(n,"mouseup"),i=new t.Emission(n,"touchend"),o=t.Promise.race([e,i]);o.when(function(t){n.emit("tap",t),e.resume(),i.resume()})}return n}();n.Tap=e}(n=t.Recognizer||(t.Recognizer={}))}(Mist||(Mist={}));/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
var Mist;!function(t){function n(t){return t.id?"#"+t.id:function(){var n;return t.hasAttribute("mid")&&(n='[mid="'+t.getAttribute("mid")+'"]'),n}()||function(){var n=i++;return t.setAttribute("mid",n),'[mid="'+n+'"]'}()}var e=function(){function e(n){this.statement=n,this.attr=new t.Attr(this),this["class"]=new t.Class(this),this.emitter=new t.Emitter(this),this.style=new t.Style(this),new t.Recognizer.Pan(this.emitter),new t.Recognizer.Tap(this.emitter)}return e.prototype.concat=function(n){var i=this.selector(),o=i.split(",").map(function(t){return t.trim()+n});return t.Component.create(e,o.join())},e.prototype.each=function(t){this.elements().forEach(t)},e.prototype.elements=function(){var t,n=this.statement;return t=n instanceof HTMLElement?[n]:n instanceof e?n.elements():[].map.call(document.querySelectorAll(n),function(t){return t})},e.prototype.on=function(n){return new t.Emission(this.emitter,n)},e.prototype.selector=function(){var t,i=this.statement;return t=i instanceof HTMLElement?n(i):i instanceof e?i.selector():i},e}();t.Statement=e;var i=0}(Mist||(Mist={})),function(t){t.matches=t.matches||t.mozMatchesSelector||t.msMatchesSelector||t.webkitMatchesSelector}(Element.prototype),function(t){t.closest=t.closest||function(t){for(var n=this;n&&!n.matches(t);)n=n.parentElement;return n}}(Element.prototype);