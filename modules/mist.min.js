/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
/*!
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 * @version 0.2.1
 */
function mist(t){return Mist.Component.create(Mist.Statement,t)}var Mist;!function(t){function n(t){return JSON.stringify(t.map(function(t){return t instanceof Object?t.sessions||(t.sessions=o++):t}))}var e=function(){function t(){}return t.create=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var i=n([t]),r=n(e);return this.responses[i]||(this.responses[i]={}),this.responses[i][r]||(this.responses[i][r]=new(t.bind.apply(t,[t].concat([].slice.apply(e))))),this.responses[i][r]},t.responses={},t}();t.Component=e;var o=0}(Mist||(Mist={}));/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
var Mist;!function(t){function n(t){return Object.keys(t)}var e=function(){function t(t){var n=this;this.rejector=function(t){var e=n.rejector;e.statement?e.statement(t):e.completor=e.bind(e,t)},this.resolver=function(t){var e=n.resolver;e.statement?e.statement(t):e.completor=e.bind(e,t)},t.rejector&&(this.rejector=t.rejector),t(this.resolver,this.rejector)}return t.all=function(e){return new t(function(t,o){var i,r=[];e.map(function(e,s){i=s,e.then(function(e){s in r||(r[s]=e,n(r).length>i&&(t(r),r=[]))})["catch"](function(t){r=[],o(t)})})})},t.race=function(e){return new t(function(t,o){var i,r=[];e.map(function(e,s){i=s,e.then(function(e){r[s]=e;var o=n(r).length;2>o&&t(e),o>i&&(r=[])})["catch"](function(t){r=[],o(t)})})})},t.prototype["catch"]=function(n){var e=this.rejector,o=function(t){o.resolver=t,o.rejector=t,e.completor&&e.completor()};return e.statement=function(t){try{var t=n(t);null!=t&&o.resolver(t)}catch(e){o.rejector(e)}},new t(o)},t.prototype.then=function(n,e){var o=this.resolver,i=this.rejector,r=function(t){r.resolver=t,r.rejector=i,o.completor&&o.completor()};return o.statement=function(t){try{var t=n(t);null!=t&&r.resolver(t)}catch(o){if(e){var t=e(o);null!=t&&r.resolver(t)}else r.rejector(o)}},new t(r)},t}();t.Promise=e}(Mist||(Mist={}));/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
var Mist;!function(t){var n=function(){function n(){}return n.at=function(t,n){void 0===n&&(n=0);var e=[];e.push(n),e.push(t),this.txs.push(e),this.tx()},n.on=function(n,e){var o=this;return void 0===e&&(e=0),new t.Promise(function(t,i){var r=[];r.push(e),r.push(function(){try{t(n())}catch(e){i(e)}}),o.txs.push(r),o.tx()})},n.tx=function(){var t=this;this.txd||function(){t.txd=!0;var n;(n=function(){for(var e,o=[];e=t.txs.pop();)e[0]--<0?e[1]():o.push(e);t.txs.push.apply(t.txs,o)?requestAnimationFrame(n):t.txd=!1})()}()},n.txs=[],n}();t.Frame=n}(Mist||(Mist={}));var __extends=this&&this.__extends||function(t,n){function e(){this.constructor=t}for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o]);t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)},Mist;!function(t){var n=function(n){function e(e){var o=this;this.composite=e,this.txs=[],n.call(this,function(n,e){o.txr=function(){o.txd||function(){o.txd=!0,t.Frame.at(function(){var t;try{n(o.composite)}catch(i){e(i)}for(;t=o.txs.pop();)t(o.composite);o.txd=!1})}()}})}return __extends(e,n),e.prototype.compose=function(n){var e=this;return new t.Promise(function(o){t.Frame.at(function(){e.composite=n(e.composite),e.txs.push(o),e.txr()})})},e}(t.Promise);t.Value=n}(Mist||(Mist={}));/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
var Mist;!function(t){var n;!function(t){t[t.ADD=0]="ADD",t[t.REMOVE=1]="REMOVE",t[t.TOGGLE=2]="TOGGLE"}(n||(n={}));var e=function(){function e(e){this.statement=e,this.value=new t.Value({}),this.value.then(function(t){function e(t){t.classList.add.apply(t.classList,r[n.ADD])}function o(t){t.classList.remove.apply(t.classList,r[n.REMOVE])}function i(t){r[n.TOGGLE].forEach(function(n){t.classList.toggle(n)})}var r=[];for(var s in t){var c=t[s];r[c]||(r[c]=[]),r[c].push(s),delete t[s]}r[n.ADD],r[n.REMOVE],r[n.TOGGLE],this.statement.each(function(t){e&&e(t),o&&o(t),i&&i(t)})})}return e.prototype.add=function(e,o){var i=this;return void 0===o&&(o=0),new t.Promise(function(r){var s=o>0,c=i.value.compose(function(t){return[].forEach.call(e,function(e){t[e]=n.ADD}),t});s?t.Frame.on(i.remove.bind(i,e),o).then(function(t){t.then(r)}):c.then(r)})},e.prototype.remove=function(e,o){var i=this;return void 0===o&&(o=0),new t.Promise(function(r){var s=o>0,c=i.value.compose(function(t){return[].forEach.call(e,function(e){t[e]=n.REMOVE}),t});s?t.Frame.on(i.add.bind(i,e),o).then(function(t){t.then(r)}):c.then(r)})},e.prototype.toggle=function(t){return this.value.compose(function(e){return[].forEach.call(t,function(t){switch(e[t]){case n.ADD:e[t]=n.REMOVE;break;case n.REMOVE:e[t]=n.ADD;break;case n.TOGGLE:delete e[t];break;default:e[t]=n.TOGGLE}}),e})},e}();t.Class=e}(Mist||(Mist={}));/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
var Mist;!function(t){var n=function(){function t(t){this.statement=t,this.emits={},this.obss={}}return t.customize=function(t,n){void 0===n&&(n={});var e=document.createEvent("CustomEvent");return e.initCustomEvent(t,n.bubbles||!0,n.cancelable||!0,n.detail),e},t.prototype.add=function(t,n){this.obss[t]||(this.obss[t]=[]),this.obss[t].push(n),this.ready(t)},t.prototype.emit=function(t,n){for(var e in this.obss[t])this.obss[t][e](n)},t.prototype.remove=function(t,n){function e(){var t=o.indexOf(n);0>t||o.splice(t,1)}var o=this.obss[t];o&&n?e():o=null},t.prototype.ready=function(t){var n=this,e=this.emits;e[t]||document.addEventListener(t,e[t]=function(e){var o=e.target;o instanceof Element&&o.closest(n.statement.selector())&&n.emit(t,e instanceof CustomEvent?e.detail:e)})},t}();t.Emitter=n}(Mist||(Mist={}));/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
var Mist;!function(t){var n=function(t){function n(n,e){t.call(this,function(t,o){n.add(e,function(n){try{t(n)}catch(e){o(e)}})}),this.emitter=n,this.name=e}return __extends(n,t),n.prototype.cancel=function(){this.then(null,null)},n.prototype.once=function(t,n){var e=this;return this.then(function(n){return e.cancel(),t(n)},function(t){return e.cancel(),n(t)})},n}(t.Promise);t.Emission=n}(Mist||(Mist={}));/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
var Mist;!function(t){function n(t){return t.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})}var e=function(){function e(e){this.statement=e;var o=document.createElement("style"),i=document.createTextNode("");o.appendChild(i),document.head.appendChild(o),this.value=new t.Value([{}]),this.value.then(function(t){var i=t.map(function(t){var o=[];for(var i in t)o.push(n(i)+":"+t[i]);return e.selector()+"{"+o.join(";")+"}"});o.innerHTML=i.join("")})}return e.prototype.add=function(n,e){var o=this;return void 0===e&&(e=0),new t.Promise(function(i){var r=e>0,s=o.value.compose(function(s){var c=r?{}:s[0];for(var u in n)c[u]=n[u];return r&&(s.push(c),t.Frame.on(function(){return o.value.compose(function(t){var n=t.indexOf(c);return 0>n||t.splice(n,1),t})},e).then(function(t){t.then(i)})),s});r||s.then(i)})},e.prototype.get=function(){return this.value.composite},e.prototype.set=function(t){return this.value.compose(function(){var n={};for(var e in t)n[e]=t[e];return[n]})},e}();t.Style=e}(Mist||(Mist={}));/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
var Mist;!function(t){var n;!function(n){var e=function(){function n(n){this.emitter=n;var e=!1;t.Promise.race([new t.Emission(n,"mousedown"),new t.Emission(n,"touchstart")]).then(function(t){n.emit("panstart",t),e=!0}),t.Promise.race([new t.Emission(n,"mousemove"),new t.Emission(n,"touchmove")]).then(function(t){e&&(n.emit("panmove",t),t.movementX<0&&n.emit("panleft",t),t.movementX>0&&n.emit("panright",t),t.movementY<0&&n.emit("panup",t),t.movementY>0&&n.emit("pandown",t))}),t.Promise.race([new t.Emission(n,"mouseup"),new t.Emission(n,"touchcancel"),new t.Emission(n,"touchend")]).then(function(t){n.emit("panend",t),e=!1})}return n}();n.Pan=e}(n=t.Recognizer||(t.Recognizer={}))}(Mist||(Mist={}));/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
var Mist;!function(t){var n;!function(n){var e=function(){function n(n){this.emitter=n,t.Promise.race([new t.Emission(n,"mouseup"),new t.Emission(n,"touchend")]).then(function(t){n.emit("tap",t)})}return n}();n.Tap=e}(n=t.Recognizer||(t.Recognizer={}))}(Mist||(Mist={}));/**
 * @copyright 2015 AI428
 * @description multi event, style accessor
 * @license http://opensource.org/licenses/MIT
 * @namespace Mist
 */
var Mist;!function(t){function n(t){return t.id?"#"+t.id:function(){var n;return t.hasAttribute("mid")&&(n='[mid="'+t.getAttribute("mid")+'"]'),n}()||function(){var n=o++;return t.setAttribute("mid",n),'[mid="'+n+'"]'}()}var e=function(){function e(n){this.statement=n,this["class"]=new t.Class(this),this.emitter=new t.Emitter(this),this.style=new t.Style(this),new t.Recognizer.Pan(this.emitter),new t.Recognizer.Tap(this.emitter)}return e.prototype.concat=function(n){var o=this.selector(),i=o.split(",").map(function(t){return t.trim()+n});return t.Component.create(e,i.join())},e.prototype.each=function(t){this.elements().forEach(t)},e.prototype.elements=function(){var t,n=this.statement;return t=n instanceof HTMLElement?[n]:n instanceof e?n.elements():[].map.call(document.querySelectorAll(n),function(t){return t})},e.prototype.on=function(n){return new t.Emission(this.emitter,n)},e.prototype.selector=function(){var t,o=this.statement;return t=o instanceof HTMLElement?n(o):o instanceof e?o.selector():o},e}();t.Statement=e;var o=0}(Mist||(Mist={})),function(t){t.matches=t.matches||t.mozMatchesSelector||t.msMatchesSelector||t.webkitMatchesSelector}(Element.prototype),function(t){t.closest=t.closest||function(t){for(var n=this;n&&!n.matches(t);)n=n.parentElement;return n}}(Element.prototype);